"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("rxjs/add/operator/map");
require("rxjs/add/operator/do");
var http_1 = require("@angular/http");
var core_1 = require("@angular/core");
var Movie_1 = require("./Movie");
var MovieService = (function () {
    function MovieService(http) {
        this.http = http;
        this.BaseApiUrl = 'http://api.themoviedb.org/3/';
        this.API_key = '31715fcf36132790e17c1ed113a3c822';
        this.mode = 'search/multi?query=';
        this.key = "&api_key=" + this.API_key;
        this.movieslist = new Array();
    }
    MovieService.prototype.getMovies = function (movie) {
        var _this = this;
        var movieName = "&query=" + encodeURI(movie);
        var searchQuery = this.BaseApiUrl + this.mode + this.key + movieName;
        return this.http.get(searchQuery)
            .map(function (res) { return _this.sanitizeData(res.json()); });
    };
    MovieService.prototype.sanitizeData = function (res) {
        var movies = new Array();
        res.results.forEach(function (element) {
            var movie = new Movie_1.Movie();
            if (element.id != null && element.id != "") {
                movie.setMovieID(element.id);
            }
            if (element.overview != null && element.overview != "") {
                movie.setOverview(element.overview);
            }
            if (element.first_air_date != null && element.first_air_date != "") {
                movie.setFirst_air_date(element.first_air_date);
            }
            if (element.popularity != null && element.popularity != "") {
                movie.setPopularity(element.popularity);
            }
            if (element.popularity != null && element.popularity != "") {
                movie.setPopularity(element.popularity);
            }
            if (element.media_type == "tv") {
                movie.setTitle(element.name + "  (TV series)");
            }
            else {
                movie.setTitle(element.original_title);
            }
            if (element.poster_path != null && element.poster_path != "" && element.poster_path != "null") {
                movie.setPath("http://image.tmdb.org/t/p/w92" + element.poster_path);
            }
            movies.push(movie);
            if (element.media_type == "person") {
                element.known_for.forEach(function (subelement) {
                    var submovie = new Movie_1.Movie();
                    if (subelement.first_air_date != null && subelement.first_air_date != "") {
                        submovie.setFirst_air_date(subelement.first_air_date);
                    }
                    if (subelement.overview != null && subelement.overview != "") {
                        submovie.setOverview(subelement.overview);
                    }
                    if (subelement.popularity != null && subelement.popularity != "") {
                        submovie.setPopularity(subelement.popularity);
                    }
                    if (subelement.media_type == "tv") {
                        submovie.setTitle(subelement.name + " (TV series)");
                    }
                    else {
                        submovie.setTitle(subelement.original_title);
                    }
                    if (subelement.id != null && subelement.id != "") {
                        submovie.setMovieID(subelement.id);
                    }
                    if (subelement.poster_path != "" && subelement.poster_path != null && subelement.poster_path != "null") {
                        submovie.setPath("http://image.tmdb.org/t/p/w92" + subelement.poster_path);
                    }
                    movies.push(submovie);
                });
            }
        });
        this.movieslist = movies;
        return movies;
    };
    MovieService.prototype.getMovie = function (id) {
        for (var i = 0; i < this.movieslist.length; i++) {
            if (this.movieslist[i].getMovieID() == id) {
                return this.movieslist[i];
            }
        }
    };
    return MovieService;
}());
MovieService = __decorate([
    core_1.Injectable(),
    __metadata("design:paramtypes", [http_1.Http])
], MovieService);
exports.MovieService = MovieService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW92aWUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1vdmllLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpQ0FBK0I7QUFDL0IsZ0NBQThCO0FBRTlCLHNDQUF3RDtBQUV4RCxzQ0FBMkM7QUFDM0MsaUNBQWdDO0FBS2hDLElBQWEsWUFBWTtJQU1yQixzQkFBb0IsSUFBVTtRQUFWLFNBQUksR0FBSixJQUFJLENBQU07UUFMdEIsZUFBVSxHQUFHLDhCQUE4QixDQUFDO1FBQzVDLFlBQU8sR0FBRyxrQ0FBa0MsQ0FBQztRQUM3QyxTQUFJLEdBQUcscUJBQXFCLENBQUM7UUFDN0IsUUFBRyxHQUFHLGNBQVksSUFBSSxDQUFDLE9BQVMsQ0FBQztRQUN6QyxlQUFVLEdBQVksSUFBSSxLQUFLLEVBQUUsQ0FBQztJQUNBLENBQUM7SUFFbkMsZ0NBQVMsR0FBVCxVQUFVLEtBQWE7UUFBdkIsaUJBS0M7UUFKRyxJQUFJLFNBQVMsR0FBRyxZQUFVLFNBQVMsQ0FBQyxLQUFLLENBQUcsQ0FBQztRQUM3QyxJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsR0FBRyxTQUFTLENBQUM7UUFDckUsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQzthQUM1QixHQUFHLENBQUMsVUFBQSxHQUFHLElBQUksT0FBQSxLQUFJLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxFQUE3QixDQUE2QixDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUVELG1DQUFZLEdBQVosVUFBYSxHQUFHO1FBQ1osSUFBSSxNQUFNLEdBQVksSUFBSSxLQUFLLEVBQUUsQ0FBQztRQUdsQyxHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFBLE9BQU87WUFDdkIsSUFBSSxLQUFLLEdBQUcsSUFBSSxhQUFLLEVB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QUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlCLENBQUM7UUFDTCxDQUFDO0lBQ0wsQ0FBQztJQUNMLG1CQUFDO0FBQUQsQ0FBQyxBQXZGRCxJQXVGQztBQXZGWSxZQUFZO0lBRHhCLGlCQUFVLEVBQUU7cUNBT2lCLFdBQUk7R0FOckIsWUFBWSxDQXVGeEI7QUF2Rlksb0NBQVkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXCJyeGpzL2FkZC9vcGVyYXRvci9tYXBcIjtcbmltcG9ydCBcInJ4anMvYWRkL29wZXJhdG9yL2RvXCI7XG5cbmltcG9ydCB7IEhlYWRlcnMsIEh0dHAsIFJlc3BvbnNlIH0gZnJvbSBcIkBhbmd1bGFyL2h0dHBcIjtcblxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBNb3ZpZSB9IGZyb20gJy4vTW92aWUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSBhcyBSeE9ic2VydmFibGUgfSBmcm9tIFwicnhqcy9PYnNlcnZhYmxlXCI7XG5pbXBvcnQgeyBmb3JFYWNoIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyL3NyYy91dGlscy9jb2xsZWN0aW9uJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIE1vdmllU2VydmljZSB7XG4gICAgcHJpdmF0ZSBCYXNlQXBpVXJsID0gJ2h0dHA6Ly9hcGkudGhlbW92aWVkYi5vcmcvMy8nO1xuICAgIHByaXZhdGUgQVBJX2tleSA9ICczMTcxNWZjZjM2MTMyNzkwZTE3YzFlZDExM2EzYzgyMic7XG4gICAgcHJpdmF0ZSBtb2RlID0gJ3NlYXJjaC9tdWx0aT9xdWVyeT0nO1xuICAgIHByaXZhdGUga2V5ID0gYCZhcGlfa2V5PSR7dGhpcy5BUElfa2V5fWA7XG4gICAgbW92aWVzbGlzdDogTW92aWVbXSA9IG5ldyBBcnJheSgpO1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cCkgeyB9XG5cbiAgICBnZXRNb3ZpZXMobW92aWU6IHN0cmluZykge1xuICAgICAgICBsZXQgbW92aWVOYW1lID0gYCZxdWVyeT0ke2VuY29kZVVSSShtb3ZpZSl9YDtcbiAgICAgICAgbGV0IHNlYXJjaFF1ZXJ5ID0gdGhpcy5CYXNlQXBpVXJsICsgdGhpcy5tb2RlICsgdGhpcy5rZXkgKyBtb3ZpZU5hbWU7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHNlYXJjaFF1ZXJ5KVxuICAgICAgICAgICAgLm1hcChyZXMgPT4gdGhpcy5zYW5pdGl6ZURhdGEocmVzLmpzb24oKSkpO1xuICAgIH1cblxuICAgIHNhbml0aXplRGF0YShyZXMpOiBNb3ZpZVtdIHtcbiAgICAgICAgbGV0IG1vdmllczogTW92aWVbXSA9IG5ldyBBcnJheSgpO1xuXG5cbiAgICAgICAgcmVzLnJlc3VsdHMuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgICAgICAgIGxldCBtb3ZpZSA9IG5ldyBNb3ZpZSgpO1xuICAgICAgICAgICAgaWYgKGVsZW1lbnQuaWQgIT0gbnVsbCAmJiBlbGVtZW50LmlkICE9IFwiXCIpIHtcbiAgICAgICAgICAgICAgICBtb3ZpZS5zZXRNb3ZpZUlEKGVsZW1lbnQuaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGVsZW1lbnQub3ZlcnZpZXcgIT0gbnVsbCAmJiBlbGVtZW50Lm92ZXJ2aWV3ICE9IFwiXCIpIHtcbiAgICAgICAgICAgICAgICBtb3ZpZS5zZXRPdmVydmlldyhlbGVtZW50Lm92ZXJ2aWV3KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlbGVtZW50LmZpcnN0X2Fpcl9kYXRlICE9IG51bGwgJiYgZWxlbWVudC5maXJzdF9haXJfZGF0ZSAhPSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgbW92aWUuc2V0Rmlyc3RfYWlyX2RhdGUoZWxlbWVudC5maXJzdF9haXJfZGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZWxlbWVudC5wb3B1bGFyaXR5ICE9IG51bGwgJiYgZWxlbWVudC5wb3B1bGFyaXR5ICE9IFwiXCIpIHtcblxuICAgICAgICAgICAgICAgIG1vdmllLnNldFBvcHVsYXJpdHkoZWxlbWVudC5wb3B1bGFyaXR5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlbGVtZW50LnBvcHVsYXJpdHkgIT0gbnVsbCAmJiBlbGVtZW50LnBvcHVsYXJpdHkgIT0gXCJcIikge1xuXG4gICAgICAgICAgICAgICAgbW92aWUuc2V0UG9wdWxhcml0eShlbGVtZW50LnBvcHVsYXJpdHkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGVsZW1lbnQubWVkaWFfdHlwZSA9PSBcInR2XCIpIHtcbiAgICAgICAgICAgICAgICBtb3ZpZS5zZXRUaXRsZShgJHtlbGVtZW50Lm5hbWV9ICAoVFYgc2VyaWVzKWApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBtb3ZpZS5zZXRUaXRsZShlbGVtZW50Lm9yaWdpbmFsX3RpdGxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlbGVtZW50LnBvc3Rlcl9wYXRoICE9IG51bGwgJiYgZWxlbWVudC5wb3N0ZXJfcGF0aCAhPSBcIlwiICYmIGVsZW1lbnQucG9zdGVyX3BhdGggIT0gXCJudWxsXCIpIHtcbiAgICAgICAgICAgICAgICBtb3ZpZS5zZXRQYXRoKGBodHRwOi8vaW1hZ2UudG1kYi5vcmcvdC9wL3c5MiR7ZWxlbWVudC5wb3N0ZXJfcGF0aH1gKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW92aWVzLnB1c2gobW92aWUpO1xuICAgICAgICAgICAgaWYgKGVsZW1lbnQubWVkaWFfdHlwZSA9PSBcInBlcnNvblwiKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5rbm93bl9mb3IuZm9yRWFjaChzdWJlbGVtZW50ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHN1Ym1vdmllID0gbmV3IE1vdmllKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YmVsZW1lbnQuZmlyc3RfYWlyX2RhdGUgIT0gbnVsbCAmJiBzdWJlbGVtZW50LmZpcnN0X2Fpcl9kYXRlICE9IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1vdmllLnNldEZpcnN0X2Fpcl9kYXRlKHN1YmVsZW1lbnQuZmlyc3RfYWlyX2RhdGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdWJlbGVtZW50Lm92ZXJ2aWV3ICE9IG51bGwgJiYgc3ViZWxlbWVudC5vdmVydmlldyAhPSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJtb3ZpZS5zZXRPdmVydmlldyhzdWJlbGVtZW50Lm92ZXJ2aWV3KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoc3ViZWxlbWVudC5wb3B1bGFyaXR5ICE9IG51bGwgJiYgc3ViZWxlbWVudC5wb3B1bGFyaXR5ICE9IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1vdmllLnNldFBvcHVsYXJpdHkoc3ViZWxlbWVudC5wb3B1bGFyaXR5KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoc3ViZWxlbWVudC5tZWRpYV90eXBlID09IFwidHZcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3VibW92aWUuc2V0VGl0bGUoYCR7c3ViZWxlbWVudC5uYW1lfSAoVFYgc2VyaWVzKWApO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3VibW92aWUuc2V0VGl0bGUoc3ViZWxlbWVudC5vcmlnaW5hbF90aXRsZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YmVsZW1lbnQuaWQgIT0gbnVsbCAmJiBzdWJlbGVtZW50LmlkICE9IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1vdmllLnNldE1vdmllSUQoc3ViZWxlbWVudC5pZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YmVsZW1lbnQucG9zdGVyX3BhdGggIT0gXCJcIiAmJiBzdWJlbGVtZW50LnBvc3Rlcl9wYXRoICE9IG51bGwgJiYgc3ViZWxlbWVudC5wb3N0ZXJfcGF0aCAhPSBcIm51bGxcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3VibW92aWUuc2V0UGF0aChgaHR0cDovL2ltYWdlLnRtZGIub3JnL3QvcC93OTIke3N1YmVsZW1lbnQucG9zdGVyX3BhdGh9YCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbW92aWVzLnB1c2goc3VibW92aWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLm1vdmllc2xpc3QgPSBtb3ZpZXM7XG4gICAgICAgIHJldHVybiBtb3ZpZXM7XG4gICAgfVxuICAgIGdldE1vdmllKGlkOiBudW1iZXIpOiBNb3ZpZSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5tb3ZpZXNsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5tb3ZpZXNsaXN0W2ldLmdldE1vdmllSUQoKSA9PSBpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1vdmllc2xpc3RbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=